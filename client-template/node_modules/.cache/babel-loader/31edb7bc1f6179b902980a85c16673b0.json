{"ast":null,"code":"var _jsxFileName = \"C:\\\\Development\\\\NodeJs\\\\Cwitter\\\\client-template\\\\src\\\\context\\\\AuthContext.jsx\",\n    _s = $RefreshSig$(),\n    _s2 = $RefreshSig$();\n\nimport { createContext, createRef, useCallback, useContext, useEffect, useImperativeHandle, useMemo, useState } from 'react';\nimport Header from '../components/Header';\nimport Login from '../pages/Login';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext({});\nconst contextRef = /*#__PURE__*/createRef();\nexport function AuthProvider({\n  authService,\n  authErrorEventBus,\n  children\n}) {\n  _s();\n\n  const [user, setUser] = useState(undefined);\n  useImperativeHandle(contextRef, () => user ? user.token : undefined);\n  useEffect(() => {\n    authErrorEventBus.listen(err => {\n      console.log(err);\n      setUser(undefined);\n    });\n  }, [authErrorEventBus]);\n  useEffect(() => {\n    authService.me().then(setUser).catch(console.error);\n  }, [authService]);\n  const signUp = useCallback(async (username, password, name, email, url) => authService.signup(username, password, name, email, url).then(user => setUser(user)), [authService]);\n  const logIn = useCallback(async (username, password) => authService.login(username, password).then(user => setUser(user)), [authService]);\n  const logout = useCallback(async () => authService.logout().then(() => setUser(undefined)), [authService]);\n  const context = useMemo(() => ({\n    user,\n    signUp,\n    logIn,\n    logout\n  }), [user, signUp, logIn, logout]);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: context,\n    children: user ? children : /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"app\",\n      children: [/*#__PURE__*/_jsxDEV(Header, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 69,\n        columnNumber: 11\n      }, this), /*#__PURE__*/_jsxDEV(Login, {\n        onSignUp: signUp,\n        onLogin: logIn\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 70,\n        columnNumber: 11\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }, this)\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 64,\n    columnNumber: 5\n  }, this);\n}\n\n_s(AuthProvider, \"AQfrrND3YEad7jJDe0jYvtua8vY=\", false, function () {\n  return [useImperativeHandle];\n});\n\n_c = AuthProvider;\nexport class AuthErrorEventBus {\n  listen(callback) {\n    this.callback = callback;\n  }\n\n  notify(error) {\n    this.callback(error);\n  }\n\n}\nexport default AuthContext;\nexport const fetchToken = () => contextRef.current;\nexport const useAuth = () => {\n  _s2();\n\n  return useContext(AuthContext);\n};\n\n_s2(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\n\nvar _c;\n\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"sources":["C:/Development/NodeJs/Cwitter/client-template/src/context/AuthContext.jsx"],"names":["createContext","createRef","useCallback","useContext","useEffect","useImperativeHandle","useMemo","useState","Header","Login","AuthContext","contextRef","AuthProvider","authService","authErrorEventBus","children","user","setUser","undefined","token","listen","err","console","log","me","then","catch","error","signUp","username","password","name","email","url","signup","logIn","login","logout","context","AuthErrorEventBus","callback","notify","fetchToken","current","useAuth"],"mappings":"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","sourcesContent":["import {\r\n  createContext,\r\n  createRef,\r\n  useCallback,\r\n  useContext,\r\n  useEffect,\r\n  useImperativeHandle,\r\n  useMemo,\r\n  useState,\r\n} from 'react';\r\nimport Header from '../components/Header';\r\nimport Login from '../pages/Login';\r\n\r\nconst AuthContext = createContext({});\r\n\r\nconst contextRef = createRef();\r\n\r\nexport function AuthProvider({ authService, authErrorEventBus, children }) {\r\n  const [user, setUser] = useState(undefined);\r\n\r\n  useImperativeHandle(contextRef, () => (user ? user.token : undefined));\r\n\r\n  useEffect(() => {\r\n    authErrorEventBus.listen((err) => {\r\n      console.log(err);\r\n      setUser(undefined);\r\n    });\r\n  }, [authErrorEventBus]);\r\n\r\n  useEffect(() => {\r\n    authService.me().then(setUser).catch(console.error);\r\n  }, [authService]);\r\n\r\n  const signUp = useCallback(\r\n    async (username, password, name, email, url) =>\r\n      authService\r\n        .signup(username, password, name, email, url)\r\n        .then((user) => setUser(user)),\r\n    [authService]\r\n  );\r\n\r\n  const logIn = useCallback(\r\n    async (username, password) =>\r\n      authService.login(username, password).then((user) => setUser(user)),\r\n    [authService]\r\n  );\r\n\r\n  const logout = useCallback(\r\n    async () => authService.logout().then(() => setUser(undefined)),\r\n    [authService]\r\n  );\r\n\r\n  const context = useMemo(\r\n    () => ({\r\n      user,\r\n      signUp,\r\n      logIn,\r\n      logout,\r\n    }),\r\n    [user, signUp, logIn, logout]\r\n  );\r\n\r\n  return (\r\n    <AuthContext.Provider value={context}>\r\n      {user ? (\r\n        children\r\n      ) : (\r\n        <div className='app'>\r\n          <Header />\r\n          <Login onSignUp={signUp} onLogin={logIn} />\r\n        </div>\r\n      )}\r\n    </AuthContext.Provider>\r\n  );\r\n}\r\n\r\nexport class AuthErrorEventBus {\r\n  listen(callback) {\r\n    this.callback = callback;\r\n  }\r\n  notify(error) {\r\n    this.callback(error);\r\n  }\r\n}\r\n\r\nexport default AuthContext;\r\nexport const fetchToken = () => contextRef.current;\r\nexport const useAuth = () => useContext(AuthContext);\r\n"]},"metadata":{},"sourceType":"module"}